# 図書館管理システム セキュリティ設定ガイド

## 1. デプロイ時の設定

### 基本設定
```
実行ユーザー: 自分（USER_DEPLOYING）
アクセス権: 自分のみ（MYSELF）
```

この設定により、デプロイしたユーザーのみがアクセス可能になります。

## 2. 組織内での共有方法

### Option A: 特定のユーザーと共有（推奨）
1. Google Apps Scriptエディタを開く
2. 右上の「共有」ボタンをクリック
3. 特定のユーザーのメールアドレスを追加
4. 権限を「閲覧者」に設定
5. デプロイURLを共有されたユーザーに通知

### Option B: ドメイン内全体で共有
1. Google Apps Scriptエディタを開く
2. 右上の「共有」ボタンをクリック
3. 「リンクを取得」で「組織名内の全員」を選択
4. 権限を「閲覧者」に設定

## 3. 高度なアクセス制御（オプション）

許可されたユーザーのみアクセスできるようにする場合：

```javascript
// コード.jsの先頭に追加
const ALLOWED_USERS = [
  'user1@example.com',
  'user2@example.com',
  'admin@example.com'
];

function doGet(e) {
  const user = Session.getActiveUser().getEmail();
  
  // 許可リストチェック
  if (!ALLOWED_USERS.includes(user)) {
    return HtmlService.createHtmlOutput(`
      <h1>アクセスが拒否されました</h1>
      <p>このシステムを使用する権限がありません。</p>
      <p>管理者にお問い合わせください。</p>
    `).setTitle('アクセス拒否');
  }
  
  // 通常の処理
  const page = e.parameter.page || 'menu';
  return HtmlService.createHtmlOutput(getHtmlContent(page))
    .setTitle('図書館管理システム')
    .addMetaTag('viewport', 'width=device-width, initial-scale=1');
}
```

## 4. スプレッドシートの権限設定

### データ保護
1. スプレッドシートを開く
2. 「共有」ボタンをクリック
3. システム管理者のみ編集権限を付与
4. その他のユーザーは「閲覧のみ」または共有しない

### シート保護（オプション）
1. 保護したいシートで右クリック
2. 「シートを保護」を選択
3. 編集権限を持つユーザーを指定

## 5. 推奨事項

### セキュリティベストプラクティス
- 定期的にアクセスログを確認
- 不要になったユーザーのアクセス権を削除
- 機密データは別のスプレッドシートに分離
- 定期的なバックアップの実施

### 監査ログ
Google Workspace管理コンソールで以下を確認：
- Apps Scriptの実行ログ
- スプレッドシートへのアクセスログ
- 共有設定の変更履歴

## 6. トラブルシューティング

### よくある問題
1. **「承認が必要です」エラー**
   - 初回実行時は承認が必要
   - 「詳細」→「安全でないページに移動」をクリック

2. **アクセス拒否エラー**
   - 共有設定を確認
   - ユーザーがGoogleにログインしているか確認

3. **データが表示されない**
   - スプレッドシートの共有設定を確認
   - SPREADSHEET_IDが正しく設定されているか確認