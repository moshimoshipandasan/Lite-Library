# 図書館管理システム 初期設定ガイド

## 1. スプレッドシートの準備

### 1.1 スプレッドシートを作成
1. Google ドライブで新しいスプレッドシートを作成
2. スプレッドシート名を「図書館管理データベース」に変更

### 1.2 必要なシートを作成
以下の名前でシートを作成してください（順番も重要）：

1. **書籍マスタ**
   - ヘッダー行（1行目）に以下を入力：
   ```
   ISBN | 書籍名 | 書籍名ヨミ | 著者 | 著者ヨミ | 出版社 | 発行年 | 価格 | カテゴリ | 登録日 | 削除フラグ
   ```

2. **書籍在庫**
   - ヘッダー行（1行目）に以下を入力：
   ```
   書籍ID | ISBN | 所在場所 | 状態 | 登録日 | 更新日 | 備考
   ```

3. **利用者マスタ**
   - ヘッダー行（1行目）に以下を入力：
   ```
   利用者ID | 利用者名 | フリガナ | メールアドレス | 電話番号 | 住所 | 生年月日 | 登録日 | 更新日 | 状態 | カード番号
   ```

4. **貸出**
   - ヘッダー行（1行目）に以下を入力：
   ```
   貸出ID | 書籍ID | 利用者ID | 貸出日 | 返却予定日 | 返却日 | 状態 | 延滞日数
   ```

5. **バックアップ管理**
   - ヘッダー行（1行目）に以下を入力：
   ```
   バックアップID | バックアップ日時 | URL | 種別 | 実行者 | ファイルサイズ | 備考
   ```

### 1.3 スプレッドシートIDを取得
1. 作成したスプレッドシートを開く
2. URLから以下の部分をコピー：
   ```
   https://docs.google.com/spreadsheets/d/【ここの部分】/edit
   ```
   例：`1A2B3C4D5E6F7G8H9I0J1K2L3M4N5O6P7Q8R9S0T1U2V3W4X5Y6Z`

## 2. Google Apps Script の設定

### 2.1 スクリプトプロパティの設定
1. GASエディタで「プロジェクトの設定」（歯車アイコン）をクリック
2. 「スクリプト プロパティ」セクションまでスクロール
3. 「プロパティを追加」をクリック
4. 以下のプロパティを設定：

| プロパティ名 | 値 |
|------------|---|
| SPREADSHEET_ID | 上記でコピーしたスプレッドシートID |
| LAST_BOOK_ID | 0 |
| LAST_USER_ID | 0 |
| LAST_LOAN_ID | 0 |
| LAST_BACKUP_ID | 0 |

### 2.2 承認の設定
1. エディタで「実行」ボタンをクリック（どの関数でもOK）
2. 承認ダイアログが表示されたら「権限を確認」
3. Googleアカウントを選択
4. 「詳細」→「安全でないページに移動」をクリック
5. 必要な権限を承認

## 3. デプロイ

1. GASエディタで「デプロイ」→「新しいデプロイ」
2. 設定：
   - 種類：ウェブアプリ
   - 説明：図書館管理システム v1.0
   - 実行ユーザー：自分
   - アクセス権：自分のみ
3. 「デプロイ」をクリック
4. 表示されたウェブアプリURLをコピー

## 4. 動作確認

1. デプロイURLにアクセス
2. メニュー画面が表示されることを確認
3. 各機能ボタンをクリックして画面遷移を確認

## トラブルシューティング

### エラー：「SPREADSHEET_IDが設定されていません」
- スクリプトプロパティのSPREADSHEET_IDが正しく設定されているか確認
- プロパティ名が正確に「SPREADSHEET_ID」になっているか確認（大文字小文字も重要）

### エラー：「シートが見つかりません」
- スプレッドシートのシート名が正確に設定されているか確認
- 特に「書籍マスタ」「書籍在庫」「利用者マスタ」「貸出」「バックアップ管理」の名前を確認

### 画面が表示されない
- デプロイが最新版になっているか確認
- 「デプロイを管理」から最新版に更新

### メニューボタンが動作しない
- ブラウザのコンソールでエラーを確認
- キャッシュをクリアして再読み込み

## セキュリティ設定

詳細は「セキュリティ設定ガイド.md」を参照してください。